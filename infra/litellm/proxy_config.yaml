# =============================================================================
# CODEXFLOW.DEV - LiteLLM Proxy Configuration
# Version: 2.0 (Decompose Pipeline + Grace Lane)
# Date: 27 Aralık 2025
# =============================================================================
#
# ALIAS STRATEGY:
# - cf-fast    → Claude Haiku 3.5 (3 org key pool) - Quick tasks
# - cf-deep    → Claude Sonnet 4 (3 org key pool) - Complex logic
# - cf-planner → GPT-4o-mini - Plan/chunk JSON only
# - cf-grace   → Llama 3.1 405B FREE (OpenRouter) - Quota exhausted fallback
# - cf-grace-fallback → GPT-4o-mini - If Llama fails
#
# =============================================================================

model_list:
  # =========================
  # FAST POOL (Claude Haiku 3.5) x3 org keys
  # Purpose: Quick, simple coding tasks
  # Cost: $0.80/1M input, $4.00/1M output
  # =========================
  - model_name: cf-fast
    litellm_params:
      model: anthropic/claude-3-5-haiku-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_A
      timeout: 60
      rpm: 120
      tpm: 50000

  - model_name: cf-fast
    litellm_params:
      model: anthropic/claude-3-5-haiku-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_B
      timeout: 60
      rpm: 120
      tpm: 50000

  - model_name: cf-fast
    litellm_params:
      model: anthropic/claude-3-5-haiku-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_C
      timeout: 60
      rpm: 120
      tpm: 50000

  # =========================
  # DEEP POOL (Claude Sonnet 4) x3 org keys
  # Purpose: Complex logic, architecture decisions
  # Cost: $3.00/1M input, $15.00/1M output
  # =========================
  - model_name: cf-deep
    litellm_params:
      model: anthropic/claude-sonnet-4-20250514
      api_key: os.environ/ANTHROPIC_KEY_ORG_A
      timeout: 120
      rpm: 60
      tpm: 30000

  - model_name: cf-deep
    litellm_params:
      model: anthropic/claude-sonnet-4-20250514
      api_key: os.environ/ANTHROPIC_KEY_ORG_B
      timeout: 120
      rpm: 60
      tpm: 30000

  - model_name: cf-deep
    litellm_params:
      model: anthropic/claude-sonnet-4-20250514
      api_key: os.environ/ANTHROPIC_KEY_ORG_C
      timeout: 120
      rpm: 60
      tpm: 30000

  # =========================
  # DEEP FALLBACK (Claude Sonnet 3.5) x3 org keys
  # Purpose: Fallback when Sonnet 4 fails
  # =========================
  - model_name: cf-deep-fallback
    litellm_params:
      model: anthropic/claude-3-5-sonnet-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_A
      timeout: 120
      rpm: 60
      tpm: 30000

  - model_name: cf-deep-fallback
    litellm_params:
      model: anthropic/claude-3-5-sonnet-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_B
      timeout: 120
      rpm: 60
      tpm: 30000

  - model_name: cf-deep-fallback
    litellm_params:
      model: anthropic/claude-3-5-sonnet-latest
      api_key: os.environ/ANTHROPIC_KEY_ORG_C
      timeout: 120
      rpm: 60
      tpm: 30000

  # =========================
  # PLANNER (GPT-4o-mini)
  # Purpose: Decompose pipeline - JSON plan generation
  # Cost: $0.15/1M input, $0.60/1M output
  # =========================
  - model_name: cf-planner
    litellm_params:
      model: openai/gpt-4o-mini
      api_key: os.environ/OPENAI_API_KEY_PLANNER
      timeout: 30
      rpm: 500
      tpm: 100000
      max_tokens: 500  # Only JSON output, keep it small

  # =========================
  # GRACE LANE PRIMARY (Llama 3.1 405B FREE via OpenRouter)
  # Purpose: When user quota exhausted - FREE fallback!
  # Cost: $0 (FREE!)
  # =========================
  - model_name: cf-grace
    litellm_params:
      model: openrouter/meta-llama/llama-3.1-405b-instruct:free
      api_key: os.environ/OPENROUTER_API_KEY
      timeout: 90  # Longer timeout for free tier
      rpm: 20
      tpm: 100000

  # =========================
  # GRACE LANE FALLBACK (GPT-4o-mini)
  # Purpose: If Llama fails, use this
  # Cost: $0.15/1M input, $0.60/1M output
  # =========================
  - model_name: cf-grace-fallback
    litellm_params:
      model: openai/gpt-4o-mini
      api_key: os.environ/OPENAI_API_KEY_GRACE
      timeout: 60
      rpm: 500
      tpm: 200000

# =============================================================================
# ROUTER SETTINGS
# =============================================================================
router_settings:
  # Routing strategy: usage-based for better load distribution
  routing_strategy: usage-based-routing
  
  # Pre-call health check
  enable_pre_call_check: true
  
  # Retry settings
  num_retries: 2
  timeout: 140
  
  # Cooldown for failing deployments
  allowed_fails: 3           # Mark unhealthy after 3 consecutive fails
  cooldown_time: 60          # 60 seconds cooldown
  
  # Redis for state management (multi-instance support)
  redis_host: os.environ/REDIS_HOST
  redis_port: os.environ/REDIS_PORT
  redis_password: os.environ/REDIS_PASSWORD

# =============================================================================
# LITELLM SETTINGS
# =============================================================================
litellm_settings:
  # Global retry and timeout
  num_retries: 2
  request_timeout: 140
  
  # Fallback chains (LiteLLM internal)
  fallbacks:
    - cf-deep: [cf-deep-fallback]      # Deep → Deep fallback
    - cf-grace: [cf-grace-fallback]    # Llama FREE → GPT-4o-mini
  
  # Cache settings (for deterministic requests)
  cache: true
  cache_params:
    type: redis
    host: os.environ/REDIS_HOST
    port: os.environ/REDIS_PORT
    password: os.environ/REDIS_PASSWORD
    ttl: 3600  # 1 hour cache

  # Logging (optional - enable in production)
  # success_callback: ["langfuse"]
  # failure_callback: ["langfuse"]

# =============================================================================
# GENERAL SETTINGS
# =============================================================================
general_settings:
  # Master key for proxy authentication
  master_key: os.environ/LITELLM_MASTER_KEY
  
  # Database for LiteLLM (optional - for virtual keys, spend tracking)
  database_url: os.environ/DATABASE_URL

# =============================================================================
# ENVIRONMENT VARIABLES REQUIRED:
# =============================================================================
# ANTHROPIC_KEY_ORG_A     - Anthropic API key (org A)
# ANTHROPIC_KEY_ORG_B     - Anthropic API key (org B)
# ANTHROPIC_KEY_ORG_C     - Anthropic API key (org C)
# OPENAI_API_KEY_PLANNER  - OpenAI key for planner
# OPENAI_API_KEY_GRACE    - OpenAI key for grace fallback
# OPENROUTER_API_KEY      - OpenRouter key for Llama FREE
# REDIS_HOST              - Redis host
# REDIS_PORT              - Redis port (default: 6379)
# REDIS_PASSWORD          - Redis password
# LITELLM_MASTER_KEY      - Master key for proxy auth
# DATABASE_URL            - Database URL (optional)
# =============================================================================

